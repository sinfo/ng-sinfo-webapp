<app-loading [content]="links"></app-loading>

<div class="wrapper pad" *ngIf="me">
  <div *ngIf="!selectedLink">
    <div class="wrapper">
      <h3 *ngIf="company">{{company.name}}</h3>
      <h6 *ngIf="company">Links</h6>
      <h3 *ngIf="!company">My Links</h3>
    </div>
  </div>

  <div class="row" *ngIf="!selectedLink">
    <div class="col-sm-12">
      <div class="portrait-wrapper">
        <img *ngIf="company" class="portrait" src="{{company.img}}">
        <img *ngIf="!company" class="portrait" src="{{me.img}}" referrerpolicy="no-referrer">
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div class="portrait-wrapper">
        <button *ngIf="!company && shareActive" type="button" class="btn btn-button rescan"
          (click)="toggleSharePerms()">
          <span class="glyphicon glyphicon-link"></span> Sharing Links: {{this.sharePerms ? "Yes" : "No"}}
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="!processedLinks?.length" class="row">
    <div class="col-sm-12">
      <h6 class="lead">
        Looks like you have not made any links yet.
        <br> You can link with {{me.role === "company" ? "attendees" : "companies"}}
        <a routerLink="/user/links/link">here</a>.
      </h6>
    </div>
  </div>


  <div id="links" *ngIf="processedLinks && !selectedLink" class='links'>

    <div *ngFor="let link of processedLinks" class="link">

      <h5 *ngIf="me.role === 'company' && 'link.attendee'" class='link-title'>{{link.attendee.name}}</h5>
      <h5 *ngIf="me.role !== 'company' && 'link.company'" class='link-title'>{{link.company.name}}</h5>

      <div class="link-note">
        <div>
          <p>
            <span class='link-section'>
              <h6 class='link-title'>Employee information </h6>
              <span><span class="panel-content-strong">Name: </span>{{link.user.name}}</span>
            </span>
          </p>
          <p *ngIf="me.role === 'company'">
            <span class='link-section'>
              <h6 class='link-title'>User information </h6>

              <span class='link-data warning' *ngIf='!link.cv'>This attendee has not submitted his CV yet</span>
              <p class='lead small tip link-title' *ngIf='link.noteEmpty && !link.cv'>No information on this user</p>
              <span class='link-data' *ngIf='link.note.contacts.email'><span class="panel-content-strong">Email:
                </span>{{link.note.contacts.email}}</span>

              <span class='link-data' *ngIf='link.note.contacts.phone'><span class="panel-content-strong">Phone:
                </span>{{link.note.contacts.phone}}</span>

              <span class='link-data' *ngIf='link.note.availability'><span class="panel-content-strong">Availability:
                </span>{{link.note.availability}}</span>

              <span class='link-data' *ngIf='link.note.degree'><span class="panel-content-strong">Degree:
                </span>{{link.note.degree}}</span>

              <span class='link-data' *ngIf='link.note.interestedIn'><span class="panel-content-strong">Interested in:
                </span>{{link.note.interestedIn}}</span>

              <span class='link-data' *ngIf='link.note.otherObservations'><span class="panel-content-strong">Other
                  Notes:
                </span>{{link.note.otherObservations}}</span>
            </span>
          </p>

          <p *ngIf="me.role !== 'company'">
            <span class='link-section'>
              <h6 class='link-title'>Company information </h6>

              <p class='lead small tip link-title' *ngIf='link.noteEmpty'>No information on this company</p>
              <span class='link-data' *ngIf='link.note.contacts.email'><span class="panel-content-strong">Email:
                </span>{{link.note.contacts.email}}</span>

              <span class='link-data' *ngIf='link.note.internships'><span class="panel-content-strong">Internships:
                </span>{{link.note.internships}}</span>

              <span class='link-data' *ngIf='link.note.otherObservations'><span class="panel-content-strong">Other
                  Notes:
                </span>{{link.note.otherObservations}}</span>
            </span>
          </p>
        </div>
        <div *ngIf="me.id === link.attendee.id" class="row rowCenter">
          <div class="col-sm-6">
            <!-- <button type="button" class="btn btn-button center" (click)="editLink(link)">
              Edit Link
            </button> -->
            <button mat-raised-button color="primary" (click)="editLink(link)" class="link-buttons">
              <mat-icon>link</mat-icon>
              <span> Edit Link</span>
            </button>
            <p *ngIf="me.role === 'company' || (me.role !== 'company' && me.id === link.attendee.id)"
              class="lead small tip">
              Tip: To edit this link's note reinsert the company's ID
            </p>
          </div>
          <div class="col-sm-6">
            <button mat-raised-button color="warn" (click)="deleteLink(link)" class="link-buttons">
              <mat-icon>link_off</mat-icon>
              <span> Delete Link</span>
            </button>
            <!-- <button type="button" class="btn btn-button btn-danger center" (click)="deleteLink(link)">
              Delete Link
            </button> -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-link *ngIf="selectedLink" [linkToEdit]="selectedLink" (updatedLink)="receiveEditedLink($event)"></app-link>

</div>